<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Onigiri Catcher2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
        .screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="startScreen" class="screen">
        <h1>Onigiri Catcher</h1>
        <p>ãŠã«ãã‚Šã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ã€ãŠèŒ¶ã‚„éšœå®³ç‰©ã‚’é¿ã‘ã‚ï¼</p>
        <button onclick="startGame()">Game Start</button>
    </div>
    <div id="gameOverScreen" class="screen hidden">
        <h2>Game Over!</h2>
        <p id="finalScore"></p>
        <button onclick="restartGame()">Play Again</button>
    </div>
    <script>
        let player;
        let onigiri;
        let obstacles = [];
        let score = 0;
        let gameOver = false;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            player = new Player();
            onigiri = new Item(random(width), 0, 'ğŸ™');
        }

        function draw() {
            background(220);
            if (gameOver) return;
            
            player.show();
            player.move();
            onigiri.fall();
            onigiri.show();
            
            obstacles.forEach(obs => {
                obs.fall();
                obs.show();
                if (obs.collidesWith(player)) {
                    endGame();
                }
            });

            if (onigiri.collidesWith(player)) {
                score++;
                onigiri.reset();
                if (score % 5 === 0) addObstacle();
            }
            
            fill(0);
            textSize(20);
            text(`ã‚¹ã‚³ã‚¢: ${score}`, 20, 30);
        }

        function startGame() {
            document.getElementById("startScreen").classList.add("hidden");
            gameOver = false;
            score = 0;
            obstacles = [];
            loop();
        }

        function restartGame() {
            document.getElementById("gameOverScreen").classList.add("hidden");
            document.getElementById("startScreen").classList.remove("hidden");
        }

        function endGame() {
            gameOver = true;
            document.getElementById("finalScore").innerText = `Final Score: ${score}`;
            document.getElementById("gameOverScreen").classList.remove("hidden");
            noLoop();
        }

        function addObstacle() {
            let types = ['ğŸµ', 'ğŸ¶', 'ğŸ¥¤', 'ğŸ‹'];
            let emoji = random(types);
            obstacles.push(new Item(random(width), 0, emoji));
        }

        class Player {
            constructor() {
                this.x = width / 2;
            }
            show() {
                textSize(32);
                text('ğŸš›', this.x, height - 50);
            }
            move() {
                this.x = mouseX;
            }
        }

        class Item {
            constructor(x, y, emoji) {
                this.x = x;
                this.y = y;
                this.emoji = emoji;
                this.speed = 5;
            }
            fall() {
                this.y += this.speed;
                if (this.y > height) this.reset();
            }
            show() {
                textSize(32);
                text(this.emoji, this.x, this.y);
            }
            reset() {
                this.x = random(width);
                this.y = 0;
            }
            collidesWith(player) {
                return dist(this.x, this.y, player.x, height - 50) < 30;
            }
        }
    </script>
</body>
</html>
